"use strict";(self.webpackChunkardplayer=self.webpackChunkardplayer||[]).push([[738],{2381:(e,t,i)=>{i.d(t,{m:()=>b});var s,a,r,n,h,o,l,d,u,m,c,v,p,T=i(47982),E=i(65855),f=i(35996),g=i(95491),y=i(38254),S=i(77708),k=i(13675),D=i.n(k),_=i(15465),A=i(4178),w=function(e,t,i,s){var a,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var h=e.length-1;h>=0;h--)(a=e[h])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n},C=function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)},L=function(e,t,i,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,i):a?a.value=i:t.set(e,i),i},b=class{constructor(e,t){this.dvrUtil=null,this.minDisplayedLiveOffset=7,this.subtitleListeners=[],this.audioTrackListeners=[],this.audioTracks=[],this.audioTrack=null,s.set(this,!1),a.set(this,0),r.set(this,0),n.set(this,!1),h.set(this,0),this._duration=0,this._dvrModeEnabled=!1,o.set(this,0),l.set(this,0),d.set(this,0),this.isAtEnd=!1,this._useAndroidInitialSeekFallback=!1,this.__seeking=!1,u.set(this,0),m.set(this,0),this._ready=!1,this._pendingSeek=0,c.set(this,-1),v.set(this,!1),this._dvrEnabled=!1,this._dvrIsLive=!1,this._dvrWindow=0,this.expectedAudios=[],p.set(this,!1),this.pinnedDvrSync=null,this.player=e,this.mediaElement=t,this.player.loop.dispatchEvent(T.J.EVENT_INIT,{}),this.player.loop.dispatchEvent(T.J.EVENT_STATUS_CHANGE,{status:"init"}),this.emap=new(D()),this.addEventListeners(),f.K.for(this.player).storageListeners.add(this),t instanceof HTMLMediaElement&&(t.textTracks.onaddtrack=e=>{this.onTextTracksChanged(e)},t.textTracks.onremovetrack=e=>{this.onTextTracksChanged(e)}),this.player.loop.dispatchEvent(T.J.EVENT_STATUS_CHANGE,{status:"ready"})}get model(){return this.player.model}get pc(){return this.model.playerConfig}get mc(){return this.model.mediaCollection}get vc(){return this.player.viewCtrl}set isRemotePlayback(e){C(this,s,"f")!==e&&(this.player.loop.dispatchEvent("Player.REMOTE_PLAYBACK_CHANGED",{isRemote:e}),this.player.isLive&&this.vc.setLiveInitialBufferState()),L(this,s,e,"f")}get isRemotePlayback(){return C(this,s,"f")}get __cumulativeDrift(){return C(this,d,"f")}debugString(){return"none"}debugQualityLevel(){return[-1,1]}get subQualities(){return _.iV.error("using base implementation for subQuality listing!"),[{level:-1,label:"Auto",width:-1}]}selectSubQuality(e){_.iV.error("using base implementation for subQuality selection!")}get currentSubQuality(){return _.iV.error("using base implementation for currentSubQuality!"),-1}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];_.iV.log("["+this.getClassTypeString()+"]",...t)}onTextTracksChanged(e){this.subtitleListeners.forEach((t=>{t.onTextTracksChanged(e)}))}addSubtitleListener(e){this.subtitleListeners.includes(e)||this.subtitleListeners.push(e)}removeSubtitleListener(e){var t=this.subtitleListeners.indexOf(e);-1!==t&&(this.subtitleListeners=this.subtitleListeners.splice(t,1))}onAudioTracksChanged(){1===this.audioTracks.length&&1===this.expectedAudios.length&&"audio-description"===this.expectedAudios[0].kind&&(this.audioTracks[0].isAudioDescription=!0),this.player.loop.dispatchEvent(T.J.AUDIO_TRACK_LIST_CHANGED,{audioTracks:this.audioTracks}),this.audioTrackListeners.forEach((e=>{e.onAudioTracksChanged(this.audioTracks)}))}addAudioTrackListener(e){this.audioTrackListeners.includes(e)||this.audioTrackListeners.push(e)}removeAudioTrackListener(e){var t=this.audioTrackListeners.indexOf(e);-1!==t&&(this.audioTrackListeners=this.audioTrackListeners.splice(t,1))}addEventListeners(){this.emap.map(this.mediaElement,"loadstart",this.onLoadStart,this),this.emap.map(this.mediaElement,"canplay",this.onCanPlay,this),this.emap.map(this.mediaElement,"play",this.onPlay,this),this.emap.map(this.mediaElement,"pause",this.onPause,this),this.emap.map(this.mediaElement,"error",this.onError,this),this.emap.map(this.mediaElement,"waiting",this.onWaiting,this),this.emap.map(this.mediaElement,"ended",this.onEnded,this),this.emap.map(this.mediaElement,"timeupdate",this.onTimeUpdate,this),this.emap.map(this.mediaElement,"seeking",this.onSeeking,this),this.emap.map(this.mediaElement,"seeked",this.onSeekEnd,this),this.emap.map(this.mediaElement,"loadedmetadata",this.onLoadedMetadata,this),this.emap.map(this.mediaElement,"loadeddata",this.onLoadedData,this),this.emap.map(this.mediaElement,"durationchange",this.onDurationChange,this),this.emap.map(this.mediaElement,"progress",this.onProgress,this),this.emap.map(this.mediaElement,"stalled",this.onStalled,this),this.emap.map(this.mediaElement,"volumechange",this.onLocalVolumeChange,this)}onLoadStart(){var e,t;E.q.isAndroidDevice&&(null!==(t=null===(e=this.mediaElement)||void 0===e?void 0:e.currentSrc)&&void 0!==t?t:"").toLowerCase().indexOf(".m3u8")>0&&(this._useAndroidInitialSeekFallback=!0)}onCanPlay(){this.mediaElement instanceof HTMLMediaElement&&!(this.mediaElement.readyState>=this.mediaElement.HAVE_FUTURE_DATA)||this.bufferingEventHandler(!1),this.setPlaybackRate(this.model.playbackRate)}onPlay(){this.startTicker(),this.playEventHandler(),this.bufferingEventHandler(!1),this.vc.setOutDelayed()}onPause(e){this.pauseEventHandler(e,!isNaN(this.mediaElement.duration)&&this.mediaElement.currentTime>=this.mediaElement.duration)}onError(e){this.handleError(e)}onWaiting(e){this.mediaElement instanceof HTMLMediaElement&&this.bufferingEventHandler(this.mediaElement.readyState<this.mediaElement.HAVE_FUTURE_DATA)}onEnded(e){this.stopTicker(),this.mediaElement.pause(),this.endEventHandler(e),this.onTimeChange(this._duration,0)}onTimeUpdate(e){this.onProgress(null),this.updateTicker()}onSeeking(){this.__seeking=!0,this.player.loop.dispatchEvent(T.J.EVENT_SEEK_START,{from:C(this,u,"f"),to:C(this,m,"f")}),this.bufferingEventHandler(!0)}onSeekEnd(e){this.__seeking=!1,this.player.loop.dispatchEvent(T.J.EVENT_SEEK_END,{position:this.getCurrentTime()}),this.bufferingEventHandler(!1)}isSeeking(){return this.__seeking}onLoadedMetadata(){this._ready=!0,this.evalInitialSeek()}onLoadedData(){this.evalInitialSeek(),this.onProgress(null)}onDurationChange(e){this._duration=this.mediaElement.duration,this._ready=!0,this.onProgress(null)}onLocalVolumeChange(e){var t=this.mediaElement.muted,i=this.mediaElement.volume;this.getVolume()/100===i&&C(this,p,"f")===t||this.player.viewCtrl.setVolumeLevel(100*i,!0,t)}onProgress(e){var t;if(this.mediaElement&&("waiting"!==(null==e?void 0:e.type)||!this.__seeking)){var i=this.getCurrentTime(),s=this.getDuration(),a=-1,r=null===(t=this.mediaElement)||void 0===t?void 0:t.buffered;if(r)for(var n=0;n<r.length;n++)if(r.start(n)<=i&&r.end(n)>=i){a=r.end(n);break}if(-1!==a){var h=Math.round(a/s*100);this.bufferProgressHandler(h)}}}onStalled(e){this.onProgress(e)}onSourceError(e){this.stopTicker(),this.handleError(e)}onTimeChange(e,t){this.updateDuration(e),this.updateTime(Math.max(t,0))}bufferingEventHandler(e){this.onProgress(null),e&&!this.isAtEnd?this.vc.showBufferingIndicator():this.vc.hideBufferingIndicator(),e!==C(this,n,"f")&&(L(this,n,e,"f"),this.player.loop.dispatchEvent(T.J.EVENT_BUFFERING,{isBuffering:e}))}bufferProgressHandler(e){this.vc.updateBufferProgress(e),L(this,h,e,"f")}playEventHandler(){this.stopOtherPlayingPlayers(),this.model.playstate=y.S.PLAYSTATE_PLAYING,this.player.loop.dispatchEvent(T.J.EVENT_STATUS_CHANGE,{status:"play"}),this.isAtEnd=!1,this.player.loop.dispatchEvent(T.J.EVENT_PLAY_STREAM,{}),this.player.pixelController._isReplay&&(this.player.pixelController.triggerPixel(g.J.SUPER_REPLAY),this.player.pixelController._isReplay=!1),this.player.pixelController.initialPlayTrigger()}pauseEventHandler(e,t){void 0===t&&(t=!1),this.model.playstate=y.S.PLAYSTATE_PAUSED,this.player.loop.dispatchEvent(T.J.EVENT_STATUS_CHANGE,{status:"pause"}),this.player.loop.dispatchEvent(T.J.EVENT_PAUSE_STREAM,{ended:t})}stopEventHandler(e){this.isAtEnd||(this.model.playstate=y.S.PLAYSTATE_STOPPED,this.player.loop.dispatchEvent(T.J.EVENT_STATUS_CHANGE,{status:"stop"}),this.bufferingEventHandler(!1),this.updateTicker(),this.stopTicker(),this.player.loop.dispatchEvent(T.J.EVENT_STOP_STREAM,{}))}endEventHandler(e){this.jumpToStart(),this.player.pixelController.triggerPixel(g.J.CLIP_ENDED),this.pauseEventHandler(e,!0),this.vc.hidePosterFrame(),this.mc.isLive||this.vc.showPlayAgain(),this.vc.hideBufferingIndicator(),"web"===E.q.platform&&this.vc.exitFullscreen(),this.player.pixelController&&(this.player.pixelController._isReplay=!0),this.isAtEnd=!0,this.player.loop.dispatchEvent(T.J.EVENT_END_STREAM,{})}evalInitialSeek(){if(this._pendingSeek>0){if(this.canSeek()){var e=this._pendingSeek;this._pendingSeek=0,this.setCurrentTime(e,!1,!1,!0)}}else this.play()}updateDuration(e){this.model.duration!==e&&(this.model.duration=e,this.player.loop.dispatchEvent(T.J.EVENT_UPDATE_STREAM_DURATION,{duration:e}))}restartMedia(){this.jumpToStart(),this.play()}resetStartAndEndTime(){this.pc.generic.vodStartSeconds=0,this.pc.generic.vodEndSeconds=0}updateTime(e){this.model.time=e,this.vc.updateTime(e),this.vc.updateTimeline(e,this.model.duration);var t=Date.now();if(t>=C(this,r,"f")+1e3){L(this,r,t,"f");var i=0,s=Math.round(this.model.duration),n=Math.round(e);this.vc._dvrEnabledAndRequested&&!this.vc._dvrIsLive&&(i=Math.min(Math.round(s-e),s)),this.player.pixelController.triggerCustomPixel(g.J.SUPER_PLAYHEAD_POSITION,!1,{currentTime:n,duration:s,dvrRelativeTime:-i})}var h=this.pc.generic.vodStartSeconds,o=this.pc.generic.vodEndSeconds;if(h>0&&e<h){var l=Math.round(e);Math.abs(C(this,a,"f")-l)>3&&(this.setCurrentTime(h,!1,!1,!0),L(this,a,l,"f"))}else o>0&&e>o&&(this.setCurrentTime(h,!1,!1,!0),this.pause());this.player.loop.dispatchEvent(T.J.EVENT_UPDATE_STREAM_TIME,{currentTime:e}),window.parent!==window&&f.K.AVAILABLE&&this.model.playstate===y.S.PLAYSTATE_PLAYING&&f.K.get(f.K.SUFFIX_GLOBAL,f.K.CURRENT_PLAYERID,!0)!==this.player.getId()&&this.pause()}removeEventListeners(){this.emap.all()}dispose(){this.log("dispose()"),this.removeEventListeners(),f.K.for(this.player).storageListeners.delete(this),this.dvrUtil&&(this.dvrUtil.dispose(),this.dvrUtil=null),this.mediaElement instanceof HTMLMediaElement&&(this.mediaElement.textTracks.onaddtrack=null,this.mediaElement.textTracks.onremovetrack=null),this.mediaElement.pause(),this.subtitleListeners=[],this.audioTrackListeners=[],this.stopTicker(),this.player.loop.dispatchEvent(T.J.EVENT_STOP_STREAM,{}),this.audioTracks=[],this.audioTrack=null}stopOtherPlayingPlayers(){f.K.add(f.K.SUFFIX_GLOBAL,f.K.CURRENT_PLAYERID,this.player.getId(),!0,!0)}onStorageValueChanged(e,t){e===f.K.CURRENT_PLAYERID&&"string"==typeof t&&this.isPlaying()&&t!==this.player.getId()&&this.pause()}loadStream(e){var t,i=1===this.model.playstate||3===this.model.playstate;if(this.model.playstate=y.S.PLAYSTATE_UNSPECIFIED,i||this.stopOtherPlayingPlayers(),this.player.loop.dispatchEvent(T.J.EVENT_LOAD_STREAM,{mediaStream:e}),this._pendingSeek=this.model.time,0===this._pendingSeek&&!this.mc.isLive){var s=this.pc.generic.vodInitialPlayheadSeconds;s<=0&&(s=this.pc.generic.vodStartSeconds),this._pendingSeek=s}if(this.mediaElement instanceof HTMLMediaElement)for(;this.mediaElement.children.length>0;)this.mediaElement.removeChild(this.mediaElement.children[0]);this.expectedAudios=e.audios,this.addSource(e);var a=null!==(t=this.pc.web.forcedVolumePercent)&&void 0!==t?t:-1,r=a>=0?a:f.K.volume(this.player),n=this.pc.generic.isMuted||f.K.muted(this.player);if(this.vc.setVolumeLevel(r,!0,n,!0,!0),i){var h=()=>{this.pause(),this.mediaElement.removeEventListener("canplay",h)};this.mediaElement.addEventListener("canplay",h)}this.mediaElement.load()}startTicker(){this.stopTicker(),this.updateTicker(),L(this,c,this.player.safeInterval((()=>{this.updateTicker()}),500),"f")}stopTicker(){clearInterval(C(this,c,"f")),L(this,c,-1,"f")}updateTicker(){this.onTimeChange(this.getDuration(),this.getCurrentTime())}play(){var e;C(this,v,"f")?this.handleError():null===(e=this.mediaElement.play())||void 0===e||e.then((()=>{var e;try{this.player.checkState()}catch(e){return void _.iV.warn("aborting async",e)}null===(e=this.vc)||void 0===e||e.hidePosterFrame(),this.startTicker()})).catch((e=>{var t,i,s;_.iV.error(e);try{this.player.checkState()}catch(e){return void _.iV.warn("aborting async",e)}null===(t=this.player)||void 0===t||t.loop.dispatchEvent(T.J.EVENT_AUTOPLAY_STREAM_PROHIBITED,{}),null===(i=this.vc)||void 0===i||i.showPlayBtn(),null===(s=this.vc)||void 0===s||s.showPosterFrame(),this.stopTicker()}))}pause(){this.mediaElement.pause(),this.mc.isLive&&this.mc.isDvrEnabled||(this.updateTicker(),this.stopTicker())}togglePlay(){C(this,v,"f")?this.handleError():this.isPlaying()?this.pause():this.play()}isPlaying(){return this.model.playstate===y.S.PLAYSTATE_PLAYING}setVolume(e,t){void 0===t&&(t=!1),e>=0&&e<=100&&(t||f.K.setVolume(this.player,e),this.mediaElement.volume=e/100)}getVolume(){return f.K.volume(this.player)}setMuted(e,t){void 0===t&&(t=!1),L(this,p,e,"f"),this.mediaElement.muted=e,this.mediaElement instanceof HTMLMediaElement&&(e?this.mediaElement.setAttribute("muted","muted"):this.mediaElement.removeAttribute("muted")),t||f.K.setMuted(this.player,e)}setCurrentTime(e,t,i,s){return void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),this.canCalculateDvrUnixTime()&&e>=this.dvrRelToUnix(0)&&(e=this.dvrUnixToRel(e)),this.getDuration()>0?this.setCurrentTimeRaw(Math.min(e,this.getDuration()-.1),t,i,s):this.setCurrentTimeRaw(e,t,i,s)}setCurrentTimeRaw(e,t,i,s){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),L(this,o,0,"f"),L(this,l,0,"f"),L(this,d,0,"f");var a=this.pc.generic.vodStartSeconds,r=this.pc.generic.vodEndSeconds;if(!s&&(a>0&&e<a||r>0&&e>r)&&this.resetStartAndEndTime(),this._ready){if(!this.canSeek())return;e=Math.max(0,e),this._pendingSeek=0,L(this,u,this.getCurrentTime(),"f"),L(this,m,e,"f");try{i||(null!==this.dvrUtil?this.dvrUtil.seek(e):this.mediaElement.currentTime=e)}catch(t){this._pendingSeek=e}}else this._pendingSeek=e;this.model.time=e,-1===C(this,c,"f")&&this.updateTicker(),this.isAtEnd&&!t&&this.play()}seekToLive(){this.canSeek()&&this.setCurrentTime(this.getDuration())}setPlaybackRate(e){this.model.playbackRate=e,this.mediaElement.playbackRate=e,this.player.loop.dispatchEvent(T.J.PLAYBACK_RATE_CHANGE,{rate:e})}getDvrToDateSync(){return null}getSmoothDvrToDateSync(e){return e&&this.canCalculateDvrUnixTime()?(null==this.pinnedDvrSync&&(this.pinnedDvrSync=this.getDvrToDateSync()),this.pinnedDvrSync):this.getDvrToDateSync()}dvrRelToUnix(e,t){void 0===t&&(t=!1);var i=this.getSmoothDvrToDateSync(t);if(null!==i){if(t)return this.__dvrRelToUnixRaw(e,i)<<0;var s=C(this,d,"f");return this.isPlaying()?0!==C(this,o,"f")&&(L(this,d,C(this,d,"f")+(this.__dvrRelToUnixRaw(this.getCurrentTime(),i)-C(this,o,"f")),"f"),L(this,o,0,"f"),L(this,l,0,"f")):0===C(this,l,"f")?(L(this,l,this.getCurrentTime(),"f"),L(this,o,this.__dvrRelToUnixRaw(C(this,l,"f"),i),"f")):s+=this.__dvrRelToUnixRaw(this.getCurrentTime(),i)-C(this,o,"f"),this.__dvrRelToUnixRaw(e,i)-s<<0}return t||(L(this,o,0,"f"),L(this,l,0,"f"),L(this,d,0,"f")),0}__dvrRelToUnixRaw(e,t){var i=t.rel-e,s=Date.now()-t.at;return(t.real+s)/1e3-i}dvrUnixToRel(e){return e-this.dvrRelToUnix(0)}canCalculateDvrUnixTime(){var e=this.getDvrToDateSync();return null!=e&&0!==e.real}dvrUnixToRelNullable(e){var t=this.dvrRelToUnixNullable(0);return null==t?null:e-t}dvrRelToUnixNullable(e,t){return void 0===t&&(t=!1),null==this.getSmoothDvrToDateSync(t)?null:this.dvrRelToUnix(e,t)}canSeek(){return this.mediaElement instanceof HTMLMediaElement&&this.mediaElement.seekable.length>0}getPercentBuffered(){return C(this,h,"f")}getCurrentTime(){return this._pendingSeek>0?this._pendingSeek:this.mediaElement.currentTime}setTimeByPercent(e){var t=e/100*this.getDuration();return this.setCurrentTime(t),t}getDuration(){var e=this.mediaElement.duration;return isNaN(e)?0:e}stop(e){this.pause(),this.jumpToStart(),this.stopEventHandler(e)}jumpToStart(){this.setCurrentTime(0,!0)}onDVRCallback(e,t,i){this._dvrEnabled=e,this._dvrWindow=t,this._dvrIsLive=i,this.player.viewCtrl.onDVRCallback(this._dvrEnabled,this._dvrWindow,this._dvrIsLive),this.player.loop.dispatchEvent(T.J.EVENT_DVR_CHANGE,{dvrEnabled:this._dvrEnabled,dvrIsLive:this._dvrIsLive,dvrWindow:this._dvrWindow})}getAudioTracks(){return[]}setAudioTrack(e){}setAudioTrackById(e){}getAudioTrack(){return null}handleError(e){var t;this.stopTicker(),e&&_.iV.error(e),L(this,v,!0,"f"),null===(t=this.player.errorCtrl)||void 0===t||t.throwStreamError(S.h.ERROR_PLAYBACK)}};s=new WeakMap,a=new WeakMap,r=new WeakMap,n=new WeakMap,h=new WeakMap,o=new WeakMap,l=new WeakMap,d=new WeakMap,u=new WeakMap,m=new WeakMap,c=new WeakMap,v=new WeakMap,p=new WeakMap,b=w([A.V],b)},15548:(e,t,i)=>{i.d(t,{i:()=>h,v:()=>o});var s=i(91821),a=i(77708),r=i(4178),n=function(e,t,i,s){var a,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var h=e.length-1;h>=0;h--)(a=e[h])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n},h=class{execute(e,t){var i,r,n;n=e.model.mediaCollection.streams.some((e=>!e.isAudioOnly))?s._.createVideo(e):s._.createAudio(e);try{null===(i=e.viewCtrl)||void 0===i||i.removeMediaCanvas()}catch(e){}null!==n?t(n):null===(r=e.errorCtrl)||void 0===r||r.throwError(a.h.MEDIACANVAS_COULD_NOT_GENERATED,!0)}};h=n([r.V],h);var o=class{execute(e,t){var i,r,n=s._.createVideo(e);try{null===(i=e.viewCtrl)||void 0===i||i.removeMediaCanvas()}catch(e){}null!==n?t(n):null===(r=e.errorCtrl)||void 0===r||r.throwError(a.h.MEDIACANVAS_COULD_NOT_GENERATED,!0)}};o=n([r.V],o)},77130:(e,t,i)=>{i.r(t),i.d(t,{default:()=>m});var s=i(2381),a=i(38254),r=i(83951),n=i(47982),h=i(65855),o=i(96735),l=i(4178),d=function(e,t,i,s){var a,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var h=e.length-1;h>=0;h--)(a=e[h])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n},u=class extends s.m{constructor(e,t){if(super(e,t),this.forcedBuffering=!1,this.lastTimeupdate=0,navigator.userAgent.match(/Safari/i)&&!navigator.userAgent.match(/Chrome/i)&&this.mc.isLive&&this.mc.isDvrEnabled&&(this.dvrUtil=new r.L(e,t,this)),t.audioTracks){var i,s,a=t.audioTracks,h=()=>{this.audioTracks=[];for(var e=0;e<t.audioTracks.length;e++){var i=t.audioTracks.item(e),s={id:i.id,label:i.label,enabled:i.enabled,language:i.language,isAudioDescription:"description"===i.kind};this.audioTracks.push(s),!0===i.enabled&&(this.audioTrack=s)}this.onAudioTracksChanged()};this.emap.map(a,"addtrack",(()=>{clearTimeout(s),s=this.player.safeTimeout((()=>{h()}))})),this.emap.map(a,"removetrack",(()=>{clearTimeout(s),s=this.player.safeTimeout((()=>{h()}))})),this.emap.map(a,"change",(()=>{clearTimeout(i),i=this.player.safeTimeout((()=>{var e,t;if(this.audioTrack)for(var i of null!==(t=null===(e=this.mediaElement)||void 0===e?void 0:e.audioTracks)&&void 0!==t?t:[])if(i.enabled!==(String(i.id)===String(this.audioTrack.id)))return void this.setAudioTrack(this.audioTrack);this.player.loop.dispatchEvent(n.J.CURRENT_AUDIO_TRACK_CHANGED,{audioTrack:this.audioTrack})}))}))}}addSource(e){var t,i;null===(i=null===(t=this.player)||void 0===t?void 0:t.pixelController)||void 0===i||i.loadStream(e.url);var s=e.url.toLowerCase();h.q.browserIsSafari&&this._pendingSeek>0&&(e.url+="#t="+this._pendingSeek,this._pendingSeek=0,this.__seeking=!0);var a=t=>{var i=document.createElement("source");i.src=e.url,i.type=t,this.mediaElement.appendChild(i),this.emap.map(i,"error",this.onSourceError,this)};switch(!0){case s.indexOf(".m3u8")>0:a("application/x-mpegURL");break;case s.indexOf(".mp4")>0:a("video/mp4");break;case s.indexOf(".ogv")>0:a("video/ogg");break;case s.indexOf(".webm")>0:a("video/webm");break;case!(0,o.fp)(e.mimeType):a(e.mimeType);break;default:this.handleError('Unknown mimetype "'+e.mimeType+'" for stream '+s)}this.dvrUtil&&this.dvrUtil.initStream(e.url)}seekToLive(){this.bufferingEventHandler(!0),this.mediaElement.load(),super.seekToLive()}play(){!this.mc.isLive||this.model.playstate!==a.S.PLAYSTATE_PAUSED||this.mediaElement.webkitCurrentPlaybackTargetIsWireless||this.dvrUtil||this.seekToLive(),this.lastTimeupdate=Date.now(),this.forcedBuffering=!1,super.play()}onTimeUpdate(e){this.lastTimeupdate=Date.now(),super.onTimeUpdate(e)}updateTicker(){super.updateTicker(),this.model.playstate===a.S.PLAYSTATE_PLAYING&&Date.now()-this.lastTimeupdate>2e3?(this.forcedBuffering=!0,this.bufferingEventHandler(!0)):this.forcedBuffering&&this.bufferingEventHandler(!1)}getAudioTracks(){var e;return null!==(e=this.audioTracks)&&void 0!==e?e:[]}setAudioTrack(e){var t,i;for(var s of(this.audioTrack=e,null!==(i=null===(t=this.mediaElement)||void 0===t?void 0:t.audioTracks)&&void 0!==i?i:[]))s.enabled=String(s.id)===String(e.id);for(var a of this.audioTracks)a.enabled=String(a.id)===String(e.id)}setAudioTrackById(e){var t,i;for(var s of null!==(i=null===(t=this.mediaElement)||void 0===t?void 0:t.audioTracks)&&void 0!==i?i:[])s.enabled=String(s.id)===String(e);for(var a of this.audioTracks)String(a.id)===String(e)?(a.enabled=!0,this.audioTrack=a):a.enabled=!1}getAudioTrack(){return this.audioTrack}getClassTypeString(){return"HtmlVideoCtrl"}getDvrToDateSync(){return this.dvrUtil?this.dvrUtil.dvrToDateSync:null}getCurrentTime(){var e,t;return null!==(t=null===(e=this.dvrUtil)||void 0===e?void 0:e.getVideoTime())&&void 0!==t?t:super.getCurrentTime()}getDuration(){var e,t;return null!==(t=null===(e=this.dvrUtil)||void 0===e?void 0:e.getCurrentDuration())&&void 0!==t?t:super.getDuration()}setTimeByPercent(e){if(this.dvrUtil){var t=e/100*this.dvrUtil.getCurrentDuration();return e>99.9?this.dvrUtil.seekToLive():this.dvrUtil.seek(t),t}return super.setTimeByPercent(e)}};u=d([l.V],u);var m={Generator:i(15548).v,Controller:u}},83951:(e,t,i)=>{i.d(t,{L:()=>T});var s,a,r,n,h,o=i(96735),l=i(13675),d=i.n(l),u=i(4178),m=function(e,t,i,s){var a,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var h=e.length-1;h>=0;h--)(a=e[h])&&(n=(r<3?a(n):r>3?a(t,i,n):a(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n},c=function(e,t,i,s){return new(i||(i=Promise))((function(a,r){function n(e){try{o(s.next(e))}catch(e){r(e)}}function h(e){try{o(s.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,h)}o((s=s.apply(e,t||[])).next())}))},v=function(e,t,i,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,i):a?a.value=i:t.set(e,i),i},p=function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)},T=class{constructor(e,t,i){this.hasDvr=!1,this.endTime=0,this.lastSegmentIndex=0,this.lastCurrentTime=0,this.lastDuration=0,this.dvrDuration=0,this.durationDelta=0,this.segmentDuration=0,this.liveSyncDurationCount=3,this.lastMediaSequence=null,this.lastNumSegments=0,this.growingWindow=!1,this.initialTimestamp=0,this.dvrData=null,this.dvrToDateSync=null,s.set(this,""),a.set(this,null),r.set(this,null),n.set(this,-1),h.set(this,null),this.player=e,this.mediaElement=t,this.playerCtrl=i,this.emap=new(d())}initStream(e){v(this,s,e,"f"),this.loadManifest(e,!0,(e=>{v(this,a,e,"f"),this.loadManifest(this.getSegmentsUrl(),!1,(e=>{v(this,r,e,"f"),this.hasDvr=e.isLive||e.duration>60,this.endTime=e.duration,this.dvrDuration=e.duration,this.segmentDuration=e.targetDuration,this.hasDvr=e.isLive||e.duration>60,this.initialTimestamp=Math.floor(Date.now()/1e3),this.lastSegmentIndex=e.segmentsList[e.segmentsList.length-1].index,this.emap.map(this.mediaElement,"timeupdate",this.handleVideoTimeUpdate,this),this.emap.map(this.mediaElement,"durationchange",this.handleVideoDurationChange,this),this.dispatchDVRInfo(),this.startManifestTimeout()}))}))}getSegmentsUrl(){var e,t,i=null!==(t=null===(e=p(this,a,"f"))||void 0===e?void 0:e.streams[0].url)&&void 0!==t?t:"";if((0,o.fp)(p(this,s,"f"))||/^http/.test(i))return i;if(!i.includes("/")){var r=p(this,s,"f").split("/");return r.pop(),r.join("/")+"/"+i}var n=new URL(p(this,s,"f"));return n.protocol+"//"+n.host+i}loadManifest(e,t,i){fetch(e).then((e=>c(this,void 0,void 0,(function*(){return yield e.text()})))).then((e=>{try{this.player.checkState()}catch(e){return void console.warn("aborting async",e)}var t=new E(e);i&&i(t.parse())})).catch((e=>{var s,r,h,o;try{this.player.checkState()}catch(e){return void console.warn("aborting async",e)}t?(this.hasDvr=!1,clearTimeout(p(this,n,"f"))):(null===(r=null===(s=p(this,a,"f"))||void 0===s?void 0:s.streams)||void 0===r?void 0:r.length)>1?(null===(o=null===(h=p(this,a,"f"))||void 0===h?void 0:h.streams)||void 0===o||o.shift(),this.loadManifest(this.getSegmentsUrl(),!1,i)):(this.hasDvr=!1,clearTimeout(p(this,n,"f")))}))}startManifestTimeout(){var e,t;clearTimeout(p(this,n,"f")),v(this,n,this.player.safeTimeout((()=>{this.loadManifest(this.getSegmentsUrl(),!1,(e=>{v(this,r,e,"f"),this.hasDvr=e.isLive||e.duration>60;var t,i,s=this.endTime;for(t=0;t<e.segmentsList.length;++t)(i=e.segmentsList[t]).index>this.lastSegmentIndex&&(this.endTime+=i.duration);this.lastSegmentIndex=e.segmentsList[e.segmentsList.length-1].index,this.endTime!==s&&this.handleVideoDurationChange(),this.setDvrToDateSync(),this.startManifestTimeout()}))}),1e3*(null!==(t=null===(e=p(this,r,"f"))||void 0===e?void 0:e.targetDuration)&&void 0!==t?t:5)),"f")}dispatchDVRInfo(){if(null!==p(this,r,"f")){this.lastCurrentTime<Math.round(this.getVideoTime())&&++this.durationDelta;var e=p(this,r,"f").firstProgTime,t=p(this,r,"f").lastProgTime;null==this.lastMediaSequence?(this.lastMediaSequence=p(this,r,"f").mediaSequence,this.lastNumSegments=p(this,r,"f").numSegments):this.lastMediaSequence===p(this,r,"f").mediaSequence?p(this,r,"f").numSegments>this.lastNumSegments&&(this.lastNumSegments=p(this,r,"f").numSegments,this.growingWindow=!0):this.growingWindow=!1,this.growingWindow&&(this.dvrDuration=(t-e)/1e3,this.endTime=this.dvrDuration);var i,s=this.dvrDuration-this.segmentDuration*this.liveSyncDurationCount,a=s+this.durationDelta,n=this.getVideoTime(),h=a-n<=this.segmentDuration*this.liveSyncDurationCount+this.segmentDuration;i=this.growingWindow?e/1e3+this.mediaElement.currentTime:this.initialTimestamp-(this.dvrDuration-this.segmentDuration*this.liveSyncDurationCount)+this.mediaElement.currentTime,this.dvrData={dvrDuration:s,currentTime:n,duration:a,liveTimestamp:i,start:e,end:t,isLive:h},this.setDvrToDateSync()}}setDvrToDateSync(){var e,t,i,s=null!==(t=null===(e=p(this,r,"f"))||void 0===e?void 0:e.firstProgTime)&&void 0!==t?t:0,a=this.getVideoTime();i=this.growingWindow?s/1e3+this.mediaElement.currentTime:this.initialTimestamp-this.dvrDuration+this.mediaElement.currentTime,this.dvrToDateSync={rel:a,real:1e3*i,at:Date.now()},this.onDVRCallback()}getVideoTime(){return Math.max(0,this.mediaElement.currentTime-(this.endTime-this.dvrDuration))}getVideoDuration(){return this.endTime}getCurrentDuration(){return this.dvrDuration-this.segmentDuration*this.liveSyncDurationCount+this.durationDelta}seek(e){this.mediaElement.currentTime=Math.max(1,Math.min(this.endTime,e))+this.endTime-this.dvrDuration}seekToLive(){this.playerCtrl.bufferingEventHandler(!0),this.mediaElement.load(),this.initStream(p(this,s,"f"))}onDVRCallback(){var e,t,i,s,a;null!==p(this,h,"f")&&p(this,h,"f").dvrEnabled===this.hasDvr&&p(this,h,"f").dvrDuration===(null===(e=this.dvrData)||void 0===e?void 0:e.dvrDuration)&&p(this,h,"f").dvrIsLive===this.dvrData.isLive||(v(this,h,{dvrEnabled:this.hasDvr,dvrDuration:null===(t=this.dvrData)||void 0===t?void 0:t.dvrDuration,dvrIsLive:null===(i=this.dvrData)||void 0===i?void 0:i.isLive},"f"),this.playerCtrl.onDVRCallback(this.hasDvr,null===(s=this.dvrData)||void 0===s?void 0:s.dvrDuration,null===(a=this.dvrData)||void 0===a?void 0:a.isLive))}dispose(){this.emap.all(),clearTimeout(p(this,n,"f"))}handleVideoTimeUpdate(){this.dispatchDVRInfo(),this.lastCurrentTime=Math.round(this.getVideoTime())}handleVideoDurationChange(){var e=Math.round(this.endTime);this.durationDelta=0,this.lastDuration!==e&&(this.lastDuration=e,this.dispatchDVRInfo())}};s=new WeakMap,a=new WeakMap,r=new WeakMap,n=new WeakMap,h=new WeakMap,T=m([u.V],T);class E{constructor(e){this.text=e}parse(){var e,t=this.text.split("\n"),i={keyInfo:{},firstProgTime:0,lastProgTime:0,streams:[],segments:{},segmentsList:[],mediaSequence:0,duration:0,isLive:!0,targetDuration:0,numSegments:0},s=!1,a=i.mediaSequence,r={},n=0,h=0;return t.forEach((t=>{var o,l,d,u,m;s&&(r.url=t,i.streams.push(r),r={},s=!1),0===t.indexOf("#EXT-X-PROGRAM-DATE-TIME:")&&(e=new Date(t.substr("#EXT-X-PROGRAM-DATE-TIME:".length)).getTime(),0===n&&(n=e),h=new Date(t.substr("#EXT-X-PROGRAM-DATE-TIME:".length)).getTime()),t.startsWith("#EXT-X-STREAM-INF")&&(s=!0),t.startsWith("#EXT-X-ENDLIST")&&(i.isLive=!1),t.startsWith("#EXT-X-KEY")&&(i.keyInfo=t.replace("#EXT-X-KEY:","").split(",").reduce(((e,t)=>{var i=t.indexOf("="),s=t.substring(0,i),a=t.substring(i+1);return e[s]=a.replace(/"/g,""),e}),{}));var c=/^#EXT-X-TARGETDURATION:?(-?[0-9.]*)?/.exec(t);(null==c?void 0:c[1])&&(i.targetDuration=parseInt(c[1],10));var v=/^#EXT-X-STREAM-INF:.*BANDWIDTH=(\d*)?/.exec(t);""!==(null!==(o=null==v?void 0:v[1])&&void 0!==o?o:"")&&(r.bandwidth=null==v?void 0:v[1]);var p=/^#EXT-X-STREAM-INF:.*RESOLUTION=(\d*x\d*)?/.exec(t);if(""!==(null!==(l=null==p?void 0:p[1])&&void 0!==l?l:"")){var T=null==p?void 0:p[1].split("x");!T||T.length<2?r.resolution={width:0,height:0}:r.resolution={width:parseInt(T[0],10),height:parseInt(T[1],10)}}var E=/^#EXTINF:?([0-9.]*)?,?(.*)?/.exec(t);""!==(null!==(d=null==E?void 0:E[1])&&void 0!==d?d:"")&&(e=parseFloat(null!==(u=null==E?void 0:E[1])&&void 0!==u?u:""),i.segments[a]=e,i.segmentsList.push({index:a,duration:e}),a+=1,i.duration+=e,++i.numSegments,0!==h&&(h+=1e3*e));var f=/^#EXT-X-MEDIA-SEQUENCE:?(-?[0-9.]*)?/.exec(t),g=null!==(m=null==f?void 0:f[1])&&void 0!==m?m:"";""!==g&&(i.mediaSequence=parseInt(g,10),a=parseInt(g,10))})),i.firstProgTime=n,i.lastProgTime=h,i}}}}]);