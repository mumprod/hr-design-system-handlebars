"use strict";(self.webpackChunkardplayer=self.webpackChunkardplayer||[]).push([[988],{22347:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var a=i(2381),s=i(13675),r=i.n(s),n=i(38254),l=i(47982),o=i(96735),h=i(15465);class d extends a.m{constructor(e,t){super(e,t),this.lastState="",this.currentMediaStream=null,this.currentTime=0,this.dvrTime=0,this.dvrLeft=0,this.dvrRight=0,1!==this.model.playbackRate&&(this.model.playbackRate=1,this.player.loop.dispatchEvent(l.J.PLAYBACK_RATE_CHANGE,{rate:1})),t.ctrl=this}get isRemotePlayback(){return!0}get castAddon(){var e;return null!==(e=this.player.addons.find((e=>"AddonChromecast"===e.ID)))&&void 0!==e?e:null}removeEventListeners(){super.removeEventListeners(),this.vc.toggleForceControlsVisible("ChromeCast",!1),this.vc.playerView.classList.remove("ardplayer-state-casting","ardplayer-state-casting-volumecontrol")}addEventListeners(){var e,t;this._dvrModeEnabled=!1,this._dvrWindow=0,this._dvrIsLive=!1,this.dvrTime=-1,this.vc.toggleForceControlsVisible("ChromeCast",!0),this.vc.playerView.classList.add("ardplayer-state-casting");const i=this.castAddon;null!==(t=null===(e=i.remotePlayer)||void 0===e?void 0:e.canControlVolume)&&void 0!==t&&t&&this.vc.playerView.classList.add("ardplayer-state-casting-volumecontrol"),this.remotePlayer=i.remotePlayer,this.remotePlayerController=i.remotePlayerController,this.emap=new(r()),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,this.onTimeUpdate,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,this.onStateChange,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,this.onMuteChange,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,this.onVolumeChange,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,this.onMediaInfoChange,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.DURATION_CHANGED,this.onDurationChange,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.LIVE_SEEKABLE_RANGE_CHANGED,this.onLiveSeekableRangeChanged,this)}onMediaInfoChange(e){this.log(e),this.mediaElement.updateCurrentSubtitleIdFromRemote()}onMuteChange(e){this.vc.setVolumeMuted(e.value,!0,!0)}onVolumeChange(e){this.vc.setVolumeLevel(100*e.value,!0,this.mediaElement.muted,!0,!0)}onStateChange(e){switch(this.log("statechange",e.value),e.value){case"PLAYING":this.onPlay();break;case"PAUSED":this.onPause(null);break;case"BUFFERING":this.bufferingEventHandler(!0);break;case"IDLE":"PLAYING"===this.lastState&&this.endEventHandler(null)}this.lastState=e.value}restartMedia(){null!==this.currentMediaStream&&this.loadStream(this.currentMediaStream)}onDurationChange(e){this._duration=e.value,this._ready=!0}getDuration(){return this._dvrModeEnabled?this._dvrWindow:this._duration}onTimeUpdate(e){this.currentTime=e.value}getCurrentTime(){var e,t,i;return this._pendingSeek>0?this._pendingSeek:this._dvrModeEnabled?this.dvrTime:null!==(i=null!==(t=null===(e=this.remotePlayer)||void 0===e?void 0:e.currentTime)&&void 0!==t?t:this.currentTime)&&void 0!==i?i:0}onLiveSeekableRangeChanged(e){var t,i;this._dvrModeEnabled=e.value&&e.value.end>0,e.value&&(this.dvrLeft=e.value.start,this.dvrRight=e.value.end),this._dvrWindow=this.dvrRight-this.dvrLeft,this.dvrTime=(null!==(i=null===(t=this.remotePlayer)||void 0===t?void 0:t.currentTime)&&void 0!==i?i:0)-this.dvrLeft,this.updateDVRValues()}updateDVRValues(){this._dvrIsLive=this.currentTime>=this.getDuration(),this.onDVRCallback(this._dvrModeEnabled,this._dvrWindow,this._dvrIsLive)}loadStream(e){var t,i,a,s,r,d,m,u,c,v,p,E,T,y,g,f;this.log("loadStream()"),this.player.viewCtrl.hidePosterFrame(),this.mediaElement.mediaLoading(),this.model.playstate=n.S.PLAYSTATE_UNSPECIFIED,this.currentMediaStream=e;const S=this.mc.isLive;if((null===(t=this.remotePlayer)||void 0===t?void 0:t.canControlVolume)&&this.vc.setVolumeLevel(100*this.remotePlayer.volumeLevel,!0,this.remotePlayer.isMuted,!0,!0),this.stopOtherPlayingPlayers(),this.player.loop.dispatchEvent(l.J.EVENT_LOAD_STREAM,{mediaStream:e}),this._pendingSeek=this.model.time,!this._pendingSeek&&!this.mc.isLive){let e=this.pc.generic.vodInitialPlayheadSeconds;e<=0&&(e=this.pc.generic.vodStartSeconds),this._pendingSeek=e}const k=[];this.mc.subtitles.map((e=>Object.assign({},e,{sources:e.sources.filter((e=>"webvtt"===e.kind&&!(0,o.fp)(e.url)))}))).filter((e=>{var t,i;return(null!==(i=null===(t=e.sources)||void 0===t?void 0:t.length)&&void 0!==i?i:0)>0})).forEach(((e,t)=>{var i;const a=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);let s=String(null!==(i=e.sources[0].url)&&void 0!==i?i:"");s.startsWith("//")&&(s=`https:${s}`),a.trackContentId=s,a.trackContentType="text/vtt",a.subtype=chrome.cast.media.TextTrackType.SUBTITLES,a.name=`${(0,o.vY)(e.languageCode)}${"simple-language"===e.kind?" - Einfache Sprache":""}`,a.language=e.languageCode,a.customData=null,k.push(a)}));const _=new chrome.cast.media.MediaInfo(e.url,e.mimeType);_.tracks=k,_.streamType=S?chrome.cast.media.StreamType.LIVE:chrome.cast.media.StreamType.BUFFERED,_.duration=S?-1:null!==(i=this.mc.meta.durationSeconds)&&void 0!==i?i:0,this.player.isAudio?(_.metadata=new chrome.cast.media.MusicTrackMediaMetadata,_.metadata.songName=null!==(a=this.mc.meta.title)&&void 0!==a?a:"",_.metadata.title=null!==(s=this.mc.meta.title)&&void 0!==s?s:"",_.metadata.albumName=null!==(m=null!==(d=null!==(r=this.mc.meta.seriesTitle)&&void 0!==r?r:this.mc.meta.subHeading)&&void 0!==d?d:this.mc.meta.synopsis)&&void 0!==m?m:"",(0,o.fp)(null===(u=this.mc.meta.publicationService)||void 0===u?void 0:u.name)||(_.metadata.albumArtist=null===(c=this.mc.meta.publicationService)||void 0===c?void 0:c.name),(0,o.fp)(this.mc.meta.broadcastedOnDateTime)||(_.metadata.releaseDate=this.mc.meta.broadcastedOnDateTime)):(_.metadata=new chrome.cast.media.MovieMediaMetadata,_.metadata.title=null!==(v=this.mc.meta.title)&&void 0!==v?v:"",_.metadata.subtitle=null!==(T=null!==(E=null!==(p=this.mc.meta.seriesTitle)&&void 0!==p?p:this.mc.meta.subHeading)&&void 0!==E?E:this.mc.meta.synopsis)&&void 0!==T?T:"",(0,o.fp)(null===(y=this.mc.meta.publicationService)||void 0===y?void 0:y.name)||(_.metadata.studio=null===(g=this.mc.meta.publicationService)||void 0===g?void 0:g.name),(0,o.fp)(this.mc.meta.broadcastedOnDateTime)||(_.metadata.releaseDate=this.mc.meta.broadcastedOnDateTime)),_.metadata.images=this.mc.meta.images.map((e=>({url:new URL(e.url,document.baseURI).href}))),this.mediaElement.mediaInfo=_;const C=new chrome.cast.media.LoadRequest(_);null===(f=cast.framework.CastContext.getInstance().getCurrentSession())||void 0===f||f.loadMedia(C).then((()=>{try{this.player.checkState()}catch(e){return void h.iV.warn("aborting async",e)}this._ready=!0,this.evalInitialSeek(),this.mediaElement.mediaLoaded()}),(()=>h.iV.error))}setCurrentTime(e,t=!1,i=!1,a=!1){if(this.remotePlayer&&this.remotePlayerController&&this.remotePlayer.canSeek){let i=Math.min(e,this.getDuration()-.1);this._dvrModeEnabled&&(i=this.dvrLeft+e,this.dvrTime=e),this.remotePlayer.currentTime=i,this.remotePlayerController.seek(),this.onStateChange({value:"BUFFERING"}),super.setCurrentTime(e,t,!0,a)}}updateTicker(){if(this._dvrModeEnabled)switch(this.model.playstate){case n.S.PLAYSTATE_PAUSED:case n.S.PLAYSTATE_PLAYING:this.dvrLeft+=.5,this.dvrRight+=.5}super.updateTicker()}canSeek(){return!0}getClassTypeString(){return"ChromecastCtrl"}addSource(e){h.iV.warn("addSource not implemented for Chromecast.")}}var m,u,c,v=d,p=function(e,t,i,a){return new(i||(i=Promise))((function(s,r){function n(e){try{o(a.next(e))}catch(e){r(e)}}function l(e){try{o(a.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,l)}o((a=a.apply(e,t||[])).next())}))},E=function(e,t,i,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?s.call(e,i):s?s.value=i:t.set(e,i),i},T=function(e,t,i,a){if("a"===i&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?a:"a"===i?a.call(e):a?a.value:t.get(e)};class y{constructor(e,t,i,a){this.idNum=e,this.language=t,this.kind=i,this.mediaElement=a,this.id=String(this.idNum)}get mode(){return this.mediaElement.currentSubtitleId===this.idNum?"showing":"hidden"}set mode(e){"showing"===e?this.mediaElement.currentSubtitleId=this.idNum:this.mediaElement.currentSubtitleId===this.idNum&&(this.mediaElement.currentSubtitleId=-1)}}class g{constructor(){this.ctrl=null,this.mediaInfo=null,m.set(this,!0),u.set(this,null),c.set(this,-1)}mediaLoading(){E(this,m,!0,"f")}mediaLoaded(){E(this,m,!1,"f"),T(this,u,"f")&&(T(this,u,"f").call(this),E(this,u,null,"f"))}get remotePlayer(){var e,t;return null!==(t=null===(e=this.ctrl)||void 0===e?void 0:e.remotePlayer)&&void 0!==t?t:null}get remotePlayerController(){var e,t;return null!==(t=null===(e=this.ctrl)||void 0===e?void 0:e.remotePlayerController)&&void 0!==t?t:null}get buffered(){return{length:0,start:()=>0,end:()=>0}}get currentTime(){var e,t;return null!==(t=null===(e=this.remotePlayer)||void 0===e?void 0:e.currentTime)&&void 0!==t?t:-1}set currentTime(e){var t,i;(null===(t=this.remotePlayer)||void 0===t?void 0:t.canSeek)&&(this.remotePlayer.currentTime=e,null===(i=this.remotePlayerController)||void 0===i||i.seek())}get duration(){var e,t;return null!==(t=null===(e=this.remotePlayer)||void 0===e?void 0:e.duration)&&void 0!==t?t:-1}get textTracks(){var e,t,i,a,s;const r=null!==(s=null!==(i=null===(t=null===(e=this.remotePlayer)||void 0===e?void 0:e.mediaInfo)||void 0===t?void 0:t.tracks)&&void 0!==i?i:null===(a=this.mediaInfo)||void 0===a?void 0:a.tracks)&&void 0!==s?s:null;return null==r?[]:r.map((e=>new y(e.trackId,e.language,"subtitles",this)))}get currentSubtitleId(){return T(this,c,"f")}set currentSubtitleId(e){E(this,c,e,"f");const t=e>=0?[e]:[],i=new chrome.cast.media.EditTracksInfoRequest(t),a=()=>{var e,a;null===(a=null===(e=cast.framework.CastContext.getInstance().getCurrentSession())||void 0===e?void 0:e.getMediaSession())||void 0===a||a.editTracksInfo(i,(()=>{var e;null===(e=this.ctrl)||void 0===e||e.log("active chromecast tracks",t)}),(e=>{var t;return null===(t=this.ctrl)||void 0===t?void 0:t.log(e)}))};T(this,m,"f")?E(this,u,a,"f"):a()}updateCurrentSubtitleIdFromRemote(){var e,t,i;const a=null!==(i=null===(t=null===(e=cast.framework.CastContext.getInstance().getCurrentSession())||void 0===e?void 0:e.getMediaSession())||void 0===t?void 0:t.activeTrackIds)&&void 0!==i?i:null;if(null!=a){const e=0===a.length?-1:a[0];e!==T(this,c,"f")&&E(this,c,e,"f")}}get muted(){var e,t;return null!==(t=null===(e=this.remotePlayer)||void 0===e?void 0:e.isMuted)&&void 0!==t&&t}set muted(e){var t;this.muted!==e&&(null===(t=this.remotePlayerController)||void 0===t||t.muteOrUnmute())}get volume(){var e,t;return null!==(t=null===(e=this.remotePlayer)||void 0===e?void 0:e.volumeLevel)&&void 0!==t?t:0}set volume(e){var t;const i=this.remotePlayer;(null==i?void 0:i.canControlVolume)&&i.volumeLevel!==e&&(i.volumeLevel=e,null===(t=this.remotePlayerController)||void 0===t||t.setVolumeLevel())}pause(){var e,t,i;!(null===(e=this.remotePlayer)||void 0===e?void 0:e.isPaused)&&(null===(t=this.remotePlayer)||void 0===t?void 0:t.canPause)&&(null===(i=this.remotePlayerController)||void 0===i||i.playOrPause())}play(){return p(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{var i,a,s,r;null!==(a=null===(i=this.remotePlayer)||void 0===i?void 0:i.isConnected)&&void 0!==a&&a?((null===(s=this.remotePlayer)||void 0===s?void 0:s.isPaused)&&(null===(r=this.remotePlayerController)||void 0===r||r.playOrPause()),e()):t(g.error())}))}))}get playbackRate(){return-1}set playbackRate(e){throw g.error()}addEventListener(e,t){throw g.error()}removeEventListener(e,t){throw g.error()}get currentSrc(){throw g.error()}load(){throw g.error()}static error(){return new Error("tried to call unsupported method on chromecast media element")}}m=new WeakMap,u=new WeakMap,c=new WeakMap;var f={Generator:class{execute(e,t){var i;try{null===(i=e.viewCtrl)||void 0===i||i.removeMediaCanvas()}catch(e){}t(new g)}},Controller:v}},2381:(e,t,i)=>{i.d(t,{m:()=>b});var a,s,r,n,l,o,h,d,m,u,c,v,p,E=i(47982),T=i(65855),y=i(35996),g=i(95491),f=i(38254),S=i(77708),k=i(13675),_=i.n(k),C=i(15465),P=i(4178),w=function(e,t,i,a){var s,r=arguments.length,n=r<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,a);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(n=(r<3?s(n):r>3?s(t,i,n):s(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n},A=function(e,t,i,a){if("a"===i&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?a:"a"===i?a.call(e):a?a.value:t.get(e)},L=function(e,t,i,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?s.call(e,i):s?s.value=i:t.set(e,i),i},b=class{constructor(e,t){this.dvrUtil=null,this.minDisplayedLiveOffset=7,this.subtitleListeners=[],this.audioTrackListeners=[],this.audioTracks=[],this.audioTrack=null,a.set(this,!1),s.set(this,0),r.set(this,0),n.set(this,!1),l.set(this,0),this._duration=0,this._dvrModeEnabled=!1,o.set(this,0),h.set(this,0),d.set(this,0),this.isAtEnd=!1,this._useAndroidInitialSeekFallback=!1,this.__seeking=!1,m.set(this,0),u.set(this,0),this._ready=!1,this._pendingSeek=0,c.set(this,-1),v.set(this,!1),this._dvrEnabled=!1,this._dvrIsLive=!1,this._dvrWindow=0,this.expectedAudios=[],p.set(this,!1),this.pinnedDvrSync=null,this.player=e,this.mediaElement=t,this.player.loop.dispatchEvent(E.J.EVENT_INIT,{}),this.player.loop.dispatchEvent(E.J.EVENT_STATUS_CHANGE,{status:"init"}),this.emap=new(_()),this.addEventListeners(),y.K.for(this.player).storageListeners.add(this),t instanceof HTMLMediaElement&&(t.textTracks.onaddtrack=e=>{this.onTextTracksChanged(e)},t.textTracks.onremovetrack=e=>{this.onTextTracksChanged(e)}),this.player.loop.dispatchEvent(E.J.EVENT_STATUS_CHANGE,{status:"ready"})}get model(){return this.player.model}get pc(){return this.model.playerConfig}get mc(){return this.model.mediaCollection}get vc(){return this.player.viewCtrl}set isRemotePlayback(e){A(this,a,"f")!==e&&(this.player.loop.dispatchEvent("Player.REMOTE_PLAYBACK_CHANGED",{isRemote:e}),this.player.isLive&&this.vc.setLiveInitialBufferState()),L(this,a,e,"f")}get isRemotePlayback(){return A(this,a,"f")}get __cumulativeDrift(){return A(this,d,"f")}debugString(){return"none"}debugQualityLevel(){return[-1,1]}get subQualities(){return C.iV.error("using base implementation for subQuality listing!"),[{level:-1,label:"Auto",width:-1}]}selectSubQuality(e){C.iV.error("using base implementation for subQuality selection!")}get currentSubQuality(){return C.iV.error("using base implementation for currentSubQuality!"),-1}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];C.iV.log("["+this.getClassTypeString()+"]",...t)}onTextTracksChanged(e){this.subtitleListeners.forEach((t=>{t.onTextTracksChanged(e)}))}addSubtitleListener(e){this.subtitleListeners.includes(e)||this.subtitleListeners.push(e)}removeSubtitleListener(e){var t=this.subtitleListeners.indexOf(e);-1!==t&&(this.subtitleListeners=this.subtitleListeners.splice(t,1))}onAudioTracksChanged(){1===this.audioTracks.length&&1===this.expectedAudios.length&&"audio-description"===this.expectedAudios[0].kind&&(this.audioTracks[0].isAudioDescription=!0),this.player.loop.dispatchEvent(E.J.AUDIO_TRACK_LIST_CHANGED,{audioTracks:this.audioTracks}),this.audioTrackListeners.forEach((e=>{e.onAudioTracksChanged(this.audioTracks)}))}addAudioTrackListener(e){this.audioTrackListeners.includes(e)||this.audioTrackListeners.push(e)}removeAudioTrackListener(e){var t=this.audioTrackListeners.indexOf(e);-1!==t&&(this.audioTrackListeners=this.audioTrackListeners.splice(t,1))}addEventListeners(){this.emap.map(this.mediaElement,"loadstart",this.onLoadStart,this),this.emap.map(this.mediaElement,"canplay",this.onCanPlay,this),this.emap.map(this.mediaElement,"play",this.onPlay,this),this.emap.map(this.mediaElement,"pause",this.onPause,this),this.emap.map(this.mediaElement,"error",this.onError,this),this.emap.map(this.mediaElement,"waiting",this.onWaiting,this),this.emap.map(this.mediaElement,"ended",this.onEnded,this),this.emap.map(this.mediaElement,"timeupdate",this.onTimeUpdate,this),this.emap.map(this.mediaElement,"seeking",this.onSeeking,this),this.emap.map(this.mediaElement,"seeked",this.onSeekEnd,this),this.emap.map(this.mediaElement,"loadedmetadata",this.onLoadedMetadata,this),this.emap.map(this.mediaElement,"loadeddata",this.onLoadedData,this),this.emap.map(this.mediaElement,"durationchange",this.onDurationChange,this),this.emap.map(this.mediaElement,"progress",this.onProgress,this),this.emap.map(this.mediaElement,"stalled",this.onStalled,this),this.emap.map(this.mediaElement,"volumechange",this.onLocalVolumeChange,this)}onLoadStart(){var e,t;T.q.isAndroidDevice&&(null!==(t=null===(e=this.mediaElement)||void 0===e?void 0:e.currentSrc)&&void 0!==t?t:"").toLowerCase().indexOf(".m3u8")>0&&(this._useAndroidInitialSeekFallback=!0)}onCanPlay(){this.mediaElement instanceof HTMLMediaElement&&!(this.mediaElement.readyState>=this.mediaElement.HAVE_FUTURE_DATA)||this.bufferingEventHandler(!1),this.setPlaybackRate(this.model.playbackRate)}onPlay(){this.startTicker(),this.playEventHandler(),this.bufferingEventHandler(!1),this.vc.setOutDelayed()}onPause(e){this.pauseEventHandler(e,!isNaN(this.mediaElement.duration)&&this.mediaElement.currentTime>=this.mediaElement.duration)}onError(e){this.handleError(e)}onWaiting(e){this.mediaElement instanceof HTMLMediaElement&&this.bufferingEventHandler(this.mediaElement.readyState<this.mediaElement.HAVE_FUTURE_DATA)}onEnded(e){this.stopTicker(),this.mediaElement.pause(),this.endEventHandler(e),this.onTimeChange(this._duration,0)}onTimeUpdate(e){this.onProgress(null),this.updateTicker()}onSeeking(){this.__seeking=!0,this.player.loop.dispatchEvent(E.J.EVENT_SEEK_START,{from:A(this,m,"f"),to:A(this,u,"f")}),this.bufferingEventHandler(!0)}onSeekEnd(e){this.__seeking=!1,this.player.loop.dispatchEvent(E.J.EVENT_SEEK_END,{position:this.getCurrentTime()}),this.bufferingEventHandler(!1)}isSeeking(){return this.__seeking}onLoadedMetadata(){this._ready=!0,this.evalInitialSeek()}onLoadedData(){this.evalInitialSeek(),this.onProgress(null)}onDurationChange(e){this._duration=this.mediaElement.duration,this._ready=!0,this.onProgress(null)}onLocalVolumeChange(e){var t=this.mediaElement.muted,i=this.mediaElement.volume;this.getVolume()/100===i&&A(this,p,"f")===t||this.player.viewCtrl.setVolumeLevel(100*i,!0,t)}onProgress(e){var t;if(this.mediaElement&&("waiting"!==(null==e?void 0:e.type)||!this.__seeking)){var i=this.getCurrentTime(),a=this.getDuration(),s=-1,r=null===(t=this.mediaElement)||void 0===t?void 0:t.buffered;if(r)for(var n=0;n<r.length;n++)if(r.start(n)<=i&&r.end(n)>=i){s=r.end(n);break}if(-1!==s){var l=Math.round(s/a*100);this.bufferProgressHandler(l)}}}onStalled(e){this.onProgress(e)}onSourceError(e){this.stopTicker(),this.handleError(e)}onTimeChange(e,t){this.updateDuration(e),this.updateTime(Math.max(t,0))}bufferingEventHandler(e){this.onProgress(null),e&&!this.isAtEnd?this.vc.showBufferingIndicator():this.vc.hideBufferingIndicator(),e!==A(this,n,"f")&&(L(this,n,e,"f"),this.player.loop.dispatchEvent(E.J.EVENT_BUFFERING,{isBuffering:e}))}bufferProgressHandler(e){this.vc.updateBufferProgress(e),L(this,l,e,"f")}playEventHandler(){this.stopOtherPlayingPlayers(),this.model.playstate=f.S.PLAYSTATE_PLAYING,this.player.loop.dispatchEvent(E.J.EVENT_STATUS_CHANGE,{status:"play"}),this.isAtEnd=!1,this.player.loop.dispatchEvent(E.J.EVENT_PLAY_STREAM,{}),this.player.pixelController._isReplay&&(this.player.pixelController.triggerPixel(g.J.SUPER_REPLAY),this.player.pixelController._isReplay=!1),this.player.pixelController.initialPlayTrigger()}pauseEventHandler(e,t){void 0===t&&(t=!1),this.model.playstate=f.S.PLAYSTATE_PAUSED,this.player.loop.dispatchEvent(E.J.EVENT_STATUS_CHANGE,{status:"pause"}),this.player.loop.dispatchEvent(E.J.EVENT_PAUSE_STREAM,{ended:t})}stopEventHandler(e){this.isAtEnd||(this.model.playstate=f.S.PLAYSTATE_STOPPED,this.player.loop.dispatchEvent(E.J.EVENT_STATUS_CHANGE,{status:"stop"}),this.bufferingEventHandler(!1),this.updateTicker(),this.stopTicker(),this.player.loop.dispatchEvent(E.J.EVENT_STOP_STREAM,{}))}endEventHandler(e){this.jumpToStart(),this.player.pixelController.triggerPixel(g.J.CLIP_ENDED),this.pauseEventHandler(e,!0),this.vc.hidePosterFrame(),this.mc.isLive||this.vc.showPlayAgain(),this.vc.hideBufferingIndicator(),"web"===T.q.platform&&this.vc.exitFullscreen(),this.player.pixelController&&(this.player.pixelController._isReplay=!0),this.isAtEnd=!0,this.player.loop.dispatchEvent(E.J.EVENT_END_STREAM,{})}evalInitialSeek(){if(this._pendingSeek>0){if(this.canSeek()){var e=this._pendingSeek;this._pendingSeek=0,this.setCurrentTime(e,!1,!1,!0)}}else this.play()}updateDuration(e){this.model.duration!==e&&(this.model.duration=e,this.player.loop.dispatchEvent(E.J.EVENT_UPDATE_STREAM_DURATION,{duration:e}))}restartMedia(){this.jumpToStart(),this.play()}resetStartAndEndTime(){this.pc.generic.vodStartSeconds=0,this.pc.generic.vodEndSeconds=0}updateTime(e){this.model.time=e,this.vc.updateTime(e),this.vc.updateTimeline(e,this.model.duration);var t=Date.now();if(t>=A(this,r,"f")+1e3){L(this,r,t,"f");var i=0,a=Math.round(this.model.duration),n=Math.round(e);this.vc._dvrEnabledAndRequested&&!this.vc._dvrIsLive&&(i=Math.min(Math.round(a-e),a)),this.player.pixelController.triggerCustomPixel(g.J.SUPER_PLAYHEAD_POSITION,!1,{currentTime:n,duration:a,dvrRelativeTime:-i})}var l=this.pc.generic.vodStartSeconds,o=this.pc.generic.vodEndSeconds;if(l>0&&e<l){var h=Math.round(e);Math.abs(A(this,s,"f")-h)>3&&(this.setCurrentTime(l,!1,!1,!0),L(this,s,h,"f"))}else o>0&&e>o&&(this.setCurrentTime(l,!1,!1,!0),this.pause());this.player.loop.dispatchEvent(E.J.EVENT_UPDATE_STREAM_TIME,{currentTime:e}),window.parent!==window&&y.K.AVAILABLE&&this.model.playstate===f.S.PLAYSTATE_PLAYING&&y.K.get(y.K.SUFFIX_GLOBAL,y.K.CURRENT_PLAYERID,!0)!==this.player.getId()&&this.pause()}removeEventListeners(){this.emap.all()}dispose(){this.log("dispose()"),this.removeEventListeners(),y.K.for(this.player).storageListeners.delete(this),this.dvrUtil&&(this.dvrUtil.dispose(),this.dvrUtil=null),this.mediaElement instanceof HTMLMediaElement&&(this.mediaElement.textTracks.onaddtrack=null,this.mediaElement.textTracks.onremovetrack=null),this.mediaElement.pause(),this.subtitleListeners=[],this.audioTrackListeners=[],this.stopTicker(),this.player.loop.dispatchEvent(E.J.EVENT_STOP_STREAM,{}),this.audioTracks=[],this.audioTrack=null}stopOtherPlayingPlayers(){y.K.add(y.K.SUFFIX_GLOBAL,y.K.CURRENT_PLAYERID,this.player.getId(),!0,!0)}onStorageValueChanged(e,t){e===y.K.CURRENT_PLAYERID&&"string"==typeof t&&this.isPlaying()&&t!==this.player.getId()&&this.pause()}loadStream(e){var t,i=1===this.model.playstate||3===this.model.playstate;if(this.model.playstate=f.S.PLAYSTATE_UNSPECIFIED,i||this.stopOtherPlayingPlayers(),this.player.loop.dispatchEvent(E.J.EVENT_LOAD_STREAM,{mediaStream:e}),this._pendingSeek=this.model.time,0===this._pendingSeek&&!this.mc.isLive){var a=this.pc.generic.vodInitialPlayheadSeconds;a<=0&&(a=this.pc.generic.vodStartSeconds),this._pendingSeek=a}if(this.mediaElement instanceof HTMLMediaElement)for(;this.mediaElement.children.length>0;)this.mediaElement.removeChild(this.mediaElement.children[0]);this.expectedAudios=e.audios,this.addSource(e);var s=null!==(t=this.pc.web.forcedVolumePercent)&&void 0!==t?t:-1,r=s>=0?s:y.K.volume(this.player),n=this.pc.generic.isMuted||y.K.muted(this.player);if(this.vc.setVolumeLevel(r,!0,n,!0,!0),i){var l=()=>{this.pause(),this.mediaElement.removeEventListener("canplay",l)};this.mediaElement.addEventListener("canplay",l)}this.mediaElement.load()}startTicker(){this.stopTicker(),this.updateTicker(),L(this,c,this.player.safeInterval((()=>{this.updateTicker()}),500),"f")}stopTicker(){clearInterval(A(this,c,"f")),L(this,c,-1,"f")}updateTicker(){this.onTimeChange(this.getDuration(),this.getCurrentTime())}play(){var e;A(this,v,"f")?this.handleError():null===(e=this.mediaElement.play())||void 0===e||e.then((()=>{var e;try{this.player.checkState()}catch(e){return void C.iV.warn("aborting async",e)}null===(e=this.vc)||void 0===e||e.hidePosterFrame(),this.startTicker()})).catch((e=>{var t,i,a;C.iV.error(e);try{this.player.checkState()}catch(e){return void C.iV.warn("aborting async",e)}null===(t=this.player)||void 0===t||t.loop.dispatchEvent(E.J.EVENT_AUTOPLAY_STREAM_PROHIBITED,{}),null===(i=this.vc)||void 0===i||i.showPlayBtn(),null===(a=this.vc)||void 0===a||a.showPosterFrame(),this.stopTicker()}))}pause(){this.mediaElement.pause(),this.mc.isLive&&this.mc.isDvrEnabled||(this.updateTicker(),this.stopTicker())}togglePlay(){A(this,v,"f")?this.handleError():this.isPlaying()?this.pause():this.play()}isPlaying(){return this.model.playstate===f.S.PLAYSTATE_PLAYING}setVolume(e,t){void 0===t&&(t=!1),e>=0&&e<=100&&(t||y.K.setVolume(this.player,e),this.mediaElement.volume=e/100)}getVolume(){return y.K.volume(this.player)}setMuted(e,t){void 0===t&&(t=!1),L(this,p,e,"f"),this.mediaElement.muted=e,this.mediaElement instanceof HTMLMediaElement&&(e?this.mediaElement.setAttribute("muted","muted"):this.mediaElement.removeAttribute("muted")),t||y.K.setMuted(this.player,e)}setCurrentTime(e,t,i,a){return void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),this.canCalculateDvrUnixTime()&&e>=this.dvrRelToUnix(0)&&(e=this.dvrUnixToRel(e)),this.getDuration()>0?this.setCurrentTimeRaw(Math.min(e,this.getDuration()-.1),t,i,a):this.setCurrentTimeRaw(e,t,i,a)}setCurrentTimeRaw(e,t,i,a){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),L(this,o,0,"f"),L(this,h,0,"f"),L(this,d,0,"f");var s=this.pc.generic.vodStartSeconds,r=this.pc.generic.vodEndSeconds;if(!a&&(s>0&&e<s||r>0&&e>r)&&this.resetStartAndEndTime(),this._ready){if(!this.canSeek())return;e=Math.max(0,e),this._pendingSeek=0,L(this,m,this.getCurrentTime(),"f"),L(this,u,e,"f");try{i||(null!==this.dvrUtil?this.dvrUtil.seek(e):this.mediaElement.currentTime=e)}catch(t){this._pendingSeek=e}}else this._pendingSeek=e;this.model.time=e,-1===A(this,c,"f")&&this.updateTicker(),this.isAtEnd&&!t&&this.play()}seekToLive(){this.canSeek()&&this.setCurrentTime(this.getDuration())}setPlaybackRate(e){this.model.playbackRate=e,this.mediaElement.playbackRate=e,this.player.loop.dispatchEvent(E.J.PLAYBACK_RATE_CHANGE,{rate:e})}getDvrToDateSync(){return null}getSmoothDvrToDateSync(e){return e&&this.canCalculateDvrUnixTime()?(null==this.pinnedDvrSync&&(this.pinnedDvrSync=this.getDvrToDateSync()),this.pinnedDvrSync):this.getDvrToDateSync()}dvrRelToUnix(e,t){void 0===t&&(t=!1);var i=this.getSmoothDvrToDateSync(t);if(null!==i){if(t)return this.__dvrRelToUnixRaw(e,i)<<0;var a=A(this,d,"f");return this.isPlaying()?0!==A(this,o,"f")&&(L(this,d,A(this,d,"f")+(this.__dvrRelToUnixRaw(this.getCurrentTime(),i)-A(this,o,"f")),"f"),L(this,o,0,"f"),L(this,h,0,"f")):0===A(this,h,"f")?(L(this,h,this.getCurrentTime(),"f"),L(this,o,this.__dvrRelToUnixRaw(A(this,h,"f"),i),"f")):a+=this.__dvrRelToUnixRaw(this.getCurrentTime(),i)-A(this,o,"f"),this.__dvrRelToUnixRaw(e,i)-a<<0}return t||(L(this,o,0,"f"),L(this,h,0,"f"),L(this,d,0,"f")),0}__dvrRelToUnixRaw(e,t){var i=t.rel-e,a=Date.now()-t.at;return(t.real+a)/1e3-i}dvrUnixToRel(e){return e-this.dvrRelToUnix(0)}canCalculateDvrUnixTime(){var e=this.getDvrToDateSync();return null!=e&&0!==e.real}dvrUnixToRelNullable(e){var t=this.dvrRelToUnixNullable(0);return null==t?null:e-t}dvrRelToUnixNullable(e,t){return void 0===t&&(t=!1),null==this.getSmoothDvrToDateSync(t)?null:this.dvrRelToUnix(e,t)}canSeek(){return this.mediaElement instanceof HTMLMediaElement&&this.mediaElement.seekable.length>0}getPercentBuffered(){return A(this,l,"f")}getCurrentTime(){return this._pendingSeek>0?this._pendingSeek:this.mediaElement.currentTime}setTimeByPercent(e){var t=e/100*this.getDuration();return this.setCurrentTime(t),t}getDuration(){var e=this.mediaElement.duration;return isNaN(e)?0:e}stop(e){this.pause(),this.jumpToStart(),this.stopEventHandler(e)}jumpToStart(){this.setCurrentTime(0,!0)}onDVRCallback(e,t,i){this._dvrEnabled=e,this._dvrWindow=t,this._dvrIsLive=i,this.player.viewCtrl.onDVRCallback(this._dvrEnabled,this._dvrWindow,this._dvrIsLive),this.player.loop.dispatchEvent(E.J.EVENT_DVR_CHANGE,{dvrEnabled:this._dvrEnabled,dvrIsLive:this._dvrIsLive,dvrWindow:this._dvrWindow})}getAudioTracks(){return[]}setAudioTrack(e){}setAudioTrackById(e){}getAudioTrack(){return null}handleError(e){var t;this.stopTicker(),e&&C.iV.error(e),L(this,v,!0,"f"),null===(t=this.player.errorCtrl)||void 0===t||t.throwStreamError(S.h.ERROR_PLAYBACK)}};a=new WeakMap,s=new WeakMap,r=new WeakMap,n=new WeakMap,l=new WeakMap,o=new WeakMap,h=new WeakMap,d=new WeakMap,m=new WeakMap,u=new WeakMap,c=new WeakMap,v=new WeakMap,p=new WeakMap,b=w([P.V],b)}}]);